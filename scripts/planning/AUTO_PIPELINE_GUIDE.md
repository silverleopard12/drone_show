# ğŸ¤– ì™„ì „ ìë™í™” í¬ë©”ì´ì…˜ íŒŒì´í”„ë¼ì¸

**ë‹¨ í•˜ë‚˜ì˜ ëª…ë ¹ì–´ë¡œ í¬ë©”ì´ì…˜ ì…ë ¥ â†’ ê¶¤ì  txt íŒŒì¼ ì¶œë ¥ê¹Œì§€ ì™„ì „ ìë™!**

---

## ğŸ¯ ë¬´ì—‡ì„ í•˜ëŠ”ê°€?

### **í•µì‹¬ ê°œë…**

```
ğŸ“¥ ì…ë ¥ txt: ë‹¨ìˆœí•œ ì‹œì‘/ë ìœ„ì¹˜ (36ê°œ ì )
  my_start.txt: 3.0,5.0,10.0  â† ë“œë¡  0 ì‹œì‘
                3.0,13.0,10.0 â† ë“œë¡  1 ì‹œì‘
                ... (36ì¤„)

  my_end.txt:   3.0,20.0,15.0 â† ëª©í‘œ 0
                3.0,25.0,15.0 â† ëª©í‘œ 1
                ... (36ì¤„)

        â¬‡ï¸

ğŸ§  ego_plannerê°€ 36ëŒ€ì˜ ì¶©ëŒì„ ìë™ íšŒí”¼!
  - 36ëŒ€ê°€ ë™ì‹œì— ì¶œë°œ
  - ì„œë¡œ 1m ì´ìƒ ê±°ë¦¬ ìœ ì§€
  - ì‹¤ì‹œê°„ ê¶¤ì  ê³µìœ  ë° ìµœì í™”
  - B-spline ê²½ë¡œ ìƒì„±

        â¬‡ï¸

ğŸ“¤ ì¶œë ¥ txt: ì¶©ëŒ íšŒí”¼ëœ ì „ì²´ ê¶¤ì  (ì‹œê°„ë³„ ìœ„ì¹˜)
  node_1.txt: 0.00ì´ˆ (3.0,5.0,10.0)
              0.05ì´ˆ (3.1,5.2,10.1) â† ë‹¤ë¥¸ ë“œë¡  í”¼í•´ì„œ ì´ë™
              0.10ì´ˆ (3.2,5.5,10.2)
              ...
              15.00ì´ˆ (3.0,20.0,15.0) â† ëª©í‘œ ë„ì°©
```

### **ìë™ ì‹¤í–‰ ê³¼ì •**

```
1. Fair Hungarian Allocation (ê³µí‰í•œ í• ë‹¹)
2. ego_planner ì‹œë®¬ë ˆì´ì…˜ (36ëŒ€ ì¶©ëŒ íšŒí”¼ â­)
3. ê¶¤ì  ìƒ˜í”Œë§ (0.05ì´ˆë§ˆë‹¤ ìœ„ì¹˜ ê¸°ë¡)
4. txt íŒŒì¼ ì¶œë ¥
```

---

## ğŸš€ ì‚¬ìš© ë°©ë²•

### **ë°©ë²• 1: Preset í¬ë©”ì´ì…˜ (ê°€ì¥ ê°„ë‹¨)**

```bash
cd /home/pjh/ego_swarm/ego-planner-swarm/scripts
python3 auto_formation_pipeline.py --num_drones 36
```

**ê²°ê³¼**: 36ëŒ€ ë“œë¡ ì´ Grid â†’ Triangle í˜•ìƒìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê¶¤ì  ìƒì„±

---

### **ë°©ë²• 2: Custom í¬ë©”ì´ì…˜**

**Step 1: í¬ë©”ì´ì…˜ íŒŒì¼ ìƒì„±**

`start_formation.txt`:
```
3.0,5.0,10.0
3.0,10.0,10.0
3.0,15.0,10.0
...
```

`end_formation.txt`:
```
3.0,20.0,15.0
3.0,25.0,15.0
3.0,30.0,15.0
...
```

**Step 2: ì‹¤í–‰**

```bash
python3 auto_formation_pipeline.py \
    --current start_formation.txt \
    --target end_formation.txt \
    --output_folder my_trajectories
```

---

### **ë°©ë²• 3: ê³ ê¸‰ ì˜µì…˜**

```bash
python3 auto_formation_pipeline.py \
    --num_drones 36 \
    --output_folder test_run \
    --sampling_dt 0.02 \
    --timeout 180
```

**íŒŒë¼ë¯¸í„° ì„¤ëª…:**
- `--output_folder`: ì¶œë ¥ í´ë” ì´ë¦„ (ê¸°ë³¸ê°’: auto_trajectories)
- `--sampling_dt`: ìƒ˜í”Œë§ ê°„ê²© ì´ˆ (ê¸°ë³¸ê°’: 0.05 = 50ms)
- `--timeout`: ìë™ ì¢…ë£Œ ì‹œê°„ ì´ˆ (ê¸°ë³¸ê°’: 120 = 2ë¶„)

---

## ğŸ“Š ì¶œë ¥ ê²°ê³¼

### **í´ë” êµ¬ì¡°**

```
auto_trajectories_20250103_143025/
â”œâ”€â”€ node_1.txt    # ë“œë¡  1 ê¶¤ì 
â”œâ”€â”€ node_2.txt    # ë“œë¡  2 ê¶¤ì 
â”œâ”€â”€ ...
â””â”€â”€ node_36.txt   # ë“œë¡  36 ê¶¤ì 
```

### **íŒŒì¼ í˜•ì‹** (`node_1.txt`)

```
1,1,0.00,move,3.00,5.00,10.00,0.0,255,255,255
2,1,0.05,move,3.01,5.12,10.05,0.0,255,255,255
3,1,0.10,move,3.02,5.24,10.10,0.0,255,255,255
...
```

**ì»¬ëŸ¼:**
1. í”„ë ˆì„ ë²ˆí˜¸
2. ë“œë¡  ID
3. ì‹œê°„ (ì´ˆ)
4. ë™ì‘ (move/hover)
5. X ìœ„ì¹˜
6. Y ìœ„ì¹˜
7. Z ìœ„ì¹˜
8. Yaw ê°ë„
9-11. RGB ìƒ‰ìƒ

---

## âš¡ ì¶©ëŒ íšŒí”¼ëŠ” ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ê°€?

### **ì…ë ¥ txt = ë‹¨ìˆœí•œ ìœ„ì¹˜**

```
my_start.txt (36ì¤„):
3.0,5.0,10.0    â† ë“œë¡  0 ì‹œì‘
3.0,13.0,10.0   â† ë“œë¡  1 ì‹œì‘
3.0,21.0,10.0   â† ë“œë¡  2 ì‹œì‘
...

my_end.txt (36ì¤„):
3.0,20.0,15.0   â† ëª©í‘œ 0
3.0,25.0,15.0   â† ëª©í‘œ 1
3.0,30.0,15.0   â† ëª©í‘œ 2
...
```

**ì´ê²ƒë§Œ ì…ë ¥í•˜ë©´ ë©ë‹ˆë‹¤!**

---

### **ego_plannerê°€ ì¶©ëŒ ìë™ íšŒí”¼**

```python
# ê° ë“œë¡ ì˜ ego_planner_nodeê°€:

while ë¹„í–‰ì¤‘:
    # 1. ë‹¤ë¥¸ 35ëŒ€ì˜ í˜„ì¬ ê¶¤ì  ìˆ˜ì‹ 
    other_trajectories = receive_from_broadcast()

    # 2. ì¶©ëŒ ì˜ˆì¸¡
    for other_drone in range(36):
        if ì¶©ëŒ_ì˜ˆìƒ(my_trajectory, other_trajectories[other_drone]):
            # 3. ê¶¤ì  ì¬ê³„íš
            my_trajectory = optimize_to_avoid_collision()

    # 4. ìƒˆ ê¶¤ì  ë¸Œë¡œë“œìºìŠ¤íŠ¸
    broadcast(my_trajectory)

    # 5. ì‹¤í–‰
    execute(my_trajectory)
```

**36ëŒ€ê°€ ëª¨ë‘ ì‹¤ì‹œê°„ìœ¼ë¡œ ì„œë¡œë¥¼ í”¼í•´ê°‘ë‹ˆë‹¤!**

---

### **ì¶œë ¥ txt = ì¶©ëŒ íšŒí”¼ ì™„ë£Œëœ ê¶¤ì **

```
node_1.txt (ë“œë¡  0ì˜ ê¶¤ì ):
1,0,0.00,move,3.00,5.00,10.00,0.0,255,255,255   â† ì‹œì‘
2,0,0.05,move,3.05,5.15,10.08,0.0,255,255,255  â† ì§ì§„
3,0,0.10,move,3.08,5.35,10.20,0.0,255,255,255  â† ì•½ê°„ ìš°íšŒ (ë“œë¡  1 íšŒí”¼)
4,0,0.15,move,3.10,5.60,10.35,0.0,255,255,255  â† ê³„ì† ìš°íšŒ
...
299,0,14.90,move,3.00,19.85,14.95,0.0,255,255,255
300,0,15.00,move,3.00,20.00,15.00,0.0,255,255,255 â† ëª©í‘œ ë„ì°©

node_2.txt (ë“œë¡  1ì˜ ê¶¤ì ):
1,1,0.00,move,3.00,13.00,10.00,0.0,255,255,255  â† ì‹œì‘
2,1,0.05,move,3.02,13.12,10.05,0.0,255,255,255 â† ì•½ê°„ ì™¼ìª½ (ë“œë¡  0 íšŒí”¼)
...
```

**ê° ë“œë¡ ì˜ ì „ì²´ ê²½ë¡œê°€ ì¶©ëŒ ì—†ì´ ê¸°ë¡ë©ë‹ˆë‹¤!**

---

### **ë¹„êµ**

| ë°©ì‹ | ì…ë ¥ | ì²˜ë¦¬ | ì¶œë ¥ | ì¶©ëŒ |
|------|------|------|------|------|
| **ë‹¨ìˆœ ë³´ê°„** | ì‹œì‘/ë | ì§ì„  ì—°ê²° | ì§ì„  ê²½ë¡œ | âŒ ì¶©ëŒ ë°œìƒ |
| **ì´ íŒŒì´í”„ë¼ì¸** | ì‹œì‘/ë | **ego_planner ì¶©ëŒ íšŒí”¼** | ìš°íšŒ ê²½ë¡œ | âœ… ì¶©ëŒ ì—†ìŒ |

---

### **ì‹¤ì œ ì˜ˆì‹œ: 2ëŒ€ êµì°¨**

```
ì…ë ¥:
  ë“œë¡  0: (0, 0, 1) â†’ (10, 0, 1)  [ë™ìª½ìœ¼ë¡œ]
  ë“œë¡  1: (5, -5, 1) â†’ (5, 5, 1)  [ë¶ìª½ìœ¼ë¡œ]
  â†’ êµì°¨ì : (5, 0, 1)ì—ì„œ ì¶©ëŒ!

ego_planner ì²˜ë¦¬:
  ë“œë¡  0: (0,0,1) â†’ (5,0,1.5) â†’ (10,0,1)  [ìœ„ë¡œ ìš°íšŒ]
  ë“œë¡  1: (5,-5,1) â†’ (5,0,0.5) â†’ (5,5,1)  [ì•„ë˜ë¡œ ìš°íšŒ]
  â†’ ì¶©ëŒ ì—†ìŒ!

ì¶œë ¥ txt:
  node_1.txt: ìš°íšŒ ê²½ë¡œ ê¸°ë¡
  node_2.txt: ìš°íšŒ ê²½ë¡œ ê¸°ë¡
```

---

## ğŸ”§ ì „ì²´ ê³¼ì • (ìë™ ì‹¤í–‰ë¨)

```
[ìë™] STEP 1: í¬ë©”ì´ì…˜ ë¡œë“œ
  - Preset ë˜ëŠ” íŒŒì¼ì—ì„œ ì½ê¸°

[ìë™] STEP 2: Fair Hungarian Allocation
  - ë“œë¡ -ëª©í‘œ ê³µí‰í•˜ê²Œ ë§¤ì¹­
  - ìµœëŒ€ ê±°ë¦¬ ìµœì†Œí™”

[ìë™] STEP 3: Launch íŒŒì¼ ìƒì„±
  - auto_generated_swarm.launch.py ìƒì„±

[ìë™] STEP 4: Ego-Swarm ì‹œë®¬ë ˆì´ì…˜
  - ì¶©ëŒ íšŒí”¼ ê¶¤ì  ìƒì„±
  - ë™ì—­í•™ ì‹œë®¬ë ˆì´ì…˜

[ìë™] STEP 5: ê¶¤ì  ê¸°ë¡
  - B-spline ê¶¤ì  ìƒ˜í”Œë§
  - txt íŒŒì¼ë¡œ ì €ì¥

[ìë™] STEP 6: ìë™ ì¢…ë£Œ
  - Timeout í›„ ë˜ëŠ” ë¯¸ì…˜ ì™„ë£Œ ì‹œ
```

---

## ğŸ’¡ ì˜ˆì‹œ ì‹œë‚˜ë¦¬ì˜¤

### **ì‹œë‚˜ë¦¬ì˜¤ 1: ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ (10ëŒ€)**

```bash
python3 auto_formation_pipeline.py --num_drones 10 --timeout 60
```
- 10ëŒ€ ë“œë¡ 
- 60ì´ˆ í›„ ìë™ ì¢…ë£Œ
- ê°€ì¥ ë¹ ë¦„

### **ì‹œë‚˜ë¦¬ì˜¤ 2: í‘œì¤€ ì‹¤í–‰ (36ëŒ€)**

```bash
python3 auto_formation_pipeline.py --num_drones 36
```
- 36ëŒ€ ë“œë¡ 
- 120ì´ˆ timeout
- í‘œì¤€ ìƒ˜í”Œë§ (0.05s)

### **ì‹œë‚˜ë¦¬ì˜¤ 3: ê³ í•´ìƒë„ ê¶¤ì  (ì´˜ì´˜í•œ ìƒ˜í”Œë§)**

```bash
python3 auto_formation_pipeline.py \
    --num_drones 36 \
    --sampling_dt 0.01 \
    --timeout 150
```
- 10ms ê°„ê²© ìƒ˜í”Œë§
- ë” ë¶€ë“œëŸ¬ìš´ ê¶¤ì 
- íŒŒì¼ í¬ê¸° 5ë°° ì¦ê°€

### **ì‹œë‚˜ë¦¬ì˜¤ 4: Custom í¬ë©”ì´ì…˜**

```bash
# ì›í˜• â†’ ì¼ë ¬ ë³€í™˜
python3 auto_formation_pipeline.py \
    --current circle_formation.txt \
    --target line_formation.txt \
    --output_folder circle_to_line
```

---

## â±ï¸ ì‹¤í–‰ ì‹œê°„ ê°€ì´ë“œ

| ë“œë¡  ìˆ˜ | ì˜ˆìƒ ì‹œê°„ | ê¶Œì¥ timeout |
|---------|----------|-------------|
| 10ëŒ€ | 30~60ì´ˆ | 90ì´ˆ |
| 25ëŒ€ | 60~90ì´ˆ | 120ì´ˆ |
| 36ëŒ€ | 90~120ì´ˆ | 150ì´ˆ |

**Note**:
- ì´ˆê¸°í™”: ~10ì´ˆ
- ê¶¤ì  ìƒì„±: ~20ì´ˆ
- ë¹„í–‰: ê±°ë¦¬ì— ë”°ë¼ 30~80ì´ˆ
- ì•ˆì „ ì—¬ìœ : +20ì´ˆ

---

## ğŸ›‘ ìˆ˜ë™ ì¢…ë£Œ

ì‹¤í–‰ ì¤‘ ì–¸ì œë“  **Ctrl+C**ë¡œ ì¢…ë£Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.

```
Press Ctrl+C to stop manually
^C
ğŸ›‘ Interrupted by user
ğŸ›‘ Stopping simulation...
ğŸ›‘ Stopping recorder...
```

---

## ğŸ› ë¬¸ì œ í•´ê²°

### 1. "Module not found: scipy"

```bash
pip3 install scipy numpy
```

### 2. "No trajectory folder found"

- timeoutì´ ë„ˆë¬´ ì§§ìŒ â†’ `--timeout 180` ì‹œë„
- ì‹œë®¬ë ˆì´ì…˜ ì‹¤íŒ¨ â†’ ë¡œê·¸ í™•ì¸

### 3. "Formation size mismatch"

- startì™€ end í¬ë©”ì´ì…˜ì˜ ë“œë¡  ìˆ˜ê°€ ë‹¤ë¦„
- íŒŒì¼ í™•ì¸: `wc -l start.txt end.txt`

### 4. ë©”ëª¨ë¦¬ ë¶€ì¡±

36ëŒ€ëŠ” ~25-29GB í•„ìš”:
- ë“œë¡  ìˆ˜ ì¤„ì´ê¸°: `--num_drones 25` ë˜ëŠ” `--num_drones 10`
- Swap í™œì„±í™”
- ë©”ëª¨ë¦¬ ì—…ê·¸ë ˆì´ë“œ

---

## ğŸ“ ì¶œë ¥ íŒŒì¼ í™œìš©

### **Pythonì—ì„œ ì½ê¸°**

```python
import pandas as pd

# ë“œë¡  1 ê¶¤ì  ì½ê¸°
df = pd.read_csv('auto_trajectories_*/node_1.txt', header=None,
                 names=['frame', 'drone_id', 'time', 'action', 'x', 'y', 'z', 'yaw', 'r', 'g', 'b'])

# ìœ„ì¹˜ë§Œ ì¶”ì¶œ
positions = df[['x', 'y', 'z']].values
print(f"Trajectory points: {len(positions)}")
```

### **MATLABì—ì„œ ì½ê¸°**

```matlab
data = readmatrix('auto_trajectories_20250103_143025/node_1.txt');
x = data(:, 5);
y = data(:, 6);
z = data(:, 7);

plot3(x, y, z);
```

### **ì‹œê°í™”**

```python
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D

fig = plt.figure()
ax = fig.add_subplot(111, projection='3d')

# ëª¨ë“  ë“œë¡  ê¶¤ì  ê·¸ë¦¬ê¸°
for i in range(1, 37):
    df = pd.read_csv(f'auto_trajectories_*/node_{i}.txt', header=None)
    ax.plot(df[4], df[5], df[6], alpha=0.5)

plt.show()
```

---

## ğŸ†š ê¸°ì¡´ ë°©ì‹ê³¼ ë¹„êµ

### **ê¸°ì¡´ (ìˆ˜ë™, 3ë‹¨ê³„)**

```bash
# í„°ë¯¸ë„ 1: ê³„íš ìƒì„±
python3 formation_planner_pipeline.py --num_drones 36

# í„°ë¯¸ë„ 2: ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
ros2 launch src/planner/plan_manage/launch/generated_swarm.launch.py

# í„°ë¯¸ë„ 3: ê¶¤ì  ê¸°ë¡
ros2 launch traj_recorder record_trajectory.launch.py num_drones:=36

# ìˆ˜ë™ìœ¼ë¡œ Ctrl+C Ã— 2ë²ˆ
```

### **ìƒˆë¡œìš´ ë°©ì‹ (ìë™, 1ë‹¨ê³„)**

```bash
# ë‹¨ í•˜ë‚˜ì˜ ëª…ë ¹ì–´!
python3 auto_formation_pipeline.py --num_drones 36

# ìë™ìœ¼ë¡œ ëª¨ë“  ê³¼ì • ì§„í–‰
# ìë™ ì¢…ë£Œ
# ë!
```

---

## ğŸ‰ ì™„ì „ ìë™í™”!

**ì´ì œ í¬ë©”ì´ì…˜ ì…ë ¥ â†’ txt íŒŒì¼ ì¶œë ¥ê¹Œì§€ ë‹¨ í•œ ì¤„ë¡œ ë!**

```bash
python3 auto_formation_pipeline.py --num_drones 36
```

**Done! ğŸš€**
